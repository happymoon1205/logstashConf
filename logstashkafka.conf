input {
  file {
    path => "/Users/gangsickmun/workspace2/final/*.log"
    start_position => "end"
    sincedb_path => "/dev/null"
  }
}

filter {
  grok {
    match => {
      "message" => "%{WORD:log_level},%{TIMESTAMP_ISO8601:log_timestamp},%{NUMBER:user_id},%{DATA:movie_id},%{DATA:movie_title},\[%{DATA:movie_genre}\],%{BASE10NUM:movie_rating}"
    }
  }

  mutate {
    gsub => ["movie_genre", "[\[\]']", ""]
  }

  ruby {
      code => "
    movie_genre = event.get('movie_genre')
    if movie_genre && !movie_genre.nil?
      event.set('movie_genre', movie_genre.split(', '))
    end
  "
  }
}

output {
    kafka {
        codec => json
        bootstrap_servers => "34.64.123.128:9092,34.64.123.128:9093,34.64.123.128:9094"
        topic_id => "user_log"
    }
}






